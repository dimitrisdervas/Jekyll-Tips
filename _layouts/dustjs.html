<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>{{ page.title }} - Jekyll Tips</title>
		<meta name="viewport" content="width=device-width,initial-scale=1">
		<meta name="generator" content="Jekyll v{{ jekyll.version }}">

		<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic,900|Inconsolata:400,700">
		<link rel="stylesheet" href="{{site.baseurl}}/css/screen.css">
   <link rel="stylesheet" href="{{ "{{site.baseurl}}/css/components.css" | prepend: site.baseurl }}">                      
		<link rel="icon" type="image/x-icon" href="/favicon.ico">

		<!--[if lt IE 9]>
		<script src="{{site.baseurl}}/js/html5shiv.min.js"></script>
		<script src="{{site.baseurl}}/js/respond.min.js"></script>
		<![endif]-->

		{% if page.duplicate_content %}
			<link rel="canonical" href="{{ page.duplicate_content }}" />
		{% endif %}
      
   <style>
   {{ page.css }}
   {{ page.scss }}   
   </style>       

      
      
 
     
	</head>

	<body>
		{% include mobile-nav.html %}
		{% include primary-nav.html %}

     <script id="entry-template">
      <div>
         <ul>
             {#posts}
             <li>
             <h3>{title}</h3>
             <a class="tag-param">{tags}</a>
              </li>{~n}
             {/posts}
         </ul>
             </div>
         </script>

      <div id="output"></div>
      <button id="load-more" type="button">Load More</button>

		<script>
			document.getElementById("open-nav").onclick = function () {
				document.body.classList.toggle("nav-open");
			};
		</script>
      
           <script type="text/javascript" src="{{ site.baseurl }}/js/components.js"></script>      
           {% include basic_components/perpagePlugins.html %}
           <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dustjs-linkedin/2.7.2/dust-full.js"></script>
  
      <script src="https://cdnjs.cloudflare.com/ajax/libs/dustjs-helpers/1.5.0/dust-helpers.min.js"></script>
      
<!--       http://jsfiddle.net/6YrCg/ -->    
     
  <script type="text/javascript" >
   $(document).ready(function () {
      var value = GetURLParameter("tags");
      
       var data = {
           "posts" : [
              {% assign comma = false %}
              {% for post in site.html-components %}
              {% unless post.hidden == true %}
                {% if comma %},{% endif %}
                {% assign comma = true %}
                {
                  "title": "{{ post.title | escape_once  }}",
                  "tags": "{{ post.tag | escape_once  }}"
                }
              {% endunless %}
              {% endfor %}
            ]
       }

       var source   = $("#entry-template").html();
      // Compile the template under the name 'hello'
       var compiled = dust.compile(source, "intro");
       dust.loadSource(compiled);
      
//       IT IS FASTER but to use it inside the same page not possible from outside page - CLICK TO TRY TEST - use no parameters in url
      $('.tag-param').on('click', function() {
          var linkCtx = dust.makeBase({ currentTag: $(this).data("tags") }).push(data);
          dust.render("intro", linkCtx, function(err, out) {
              $("#output").html(out);
          });
      }).first().click();

//       LOAD MORE BUTTON
//       http://jsfiddle.net/N2QDJ/
   $('#load-more').on('click', function(){
       var next3 = data.posts.splice(0, 3);
       if(next3.length == 0){
           return;
       }
      
       dust.render('intro', next3, function(err, str){
           console.log(err, str);
           if(str){
               $('#output').append(str);
           }
       });
   });
      
//          WE SHOULD MAKE THIS RUN ONCE IF FROM OUTSIDE PAGE - THE ONLY THE LINKS SHOULD WORK
       var urlCtx = dust.makeBase({ currentTag: value }).push(data);
       dust.render("intro", urlCtx, function(err, out) {
           $("#output").html(out);
       });

      function GetURLParameter(sParam) {
         var sPageURL = window.location.search.substring(1);
         var sURLVariables = sPageURL.split('&');
         for (var i = 0; i < sURLVariables.length; i++) {
         var sParameterName = sURLVariables[i].split('=');
         if (sParameterName[0] == sParam) {
         return sParameterName[1];
            }
         }
      }
         
   });
</script>
      
	</body>
</html>
